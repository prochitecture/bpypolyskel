import pytest
from mathutils import Vector
from bpypolyskel import bpypolyskel


verts = [
    Vector((69.44502258300781, -9.305850982666016, 0.0)),
    Vector((73.41168212890625, 20.282922744750977, 0.0)),
    Vector((59.91660690307617, 22.097259521484375, 0.0)),
    Vector((57.67115783691406, 5.321387767791748, 0.0)),
    Vector((50.14081573486328, 6.323185920715332, 0.0)),
    Vector((49.84330749511719, 4.096793174743652, 0.0)),
    Vector((44.544437408447266, 4.80919075012207, 0.0)),
    Vector((45.23863220214844, 9.974420547485352, 0.0)),
    Vector((38.855899810791016, 12.579245567321777, 0.0)),
    Vector((34.07417297363281, 13.213733673095703, 0.0)),
    Vector((27.790645599365234, 12.31200885772705, 0.0)),
    Vector((27.096437454223633, 7.146780967712402, 0.0)),
    Vector((21.358366012573242, 7.914859294891357, 0.0)),
    Vector((21.655885696411133, 10.141250610351562, 0.0)),
    Vector((12.269540786743164, 11.399129867553711, 0.0)),
    Vector((15.478535652160645, 35.31056594848633, 0.0)),
    Vector((4.916293621063232, 36.72430419921875, 0.0)),
    Vector((0.0, 0.0, 0.0)),
    Vector((69.44502258300781, -9.305850982666016, 15.015708923339844)),
    Vector((73.41168212890625, 20.282922744750977, 15.015708923339844)),
    Vector((59.91660690307617, 22.097259521484375, 15.015708923339844)),
    Vector((57.67115783691406, 5.321387767791748, 15.015708923339844)),
    Vector((50.14081573486328, 6.323185920715332, 15.015708923339844)),
    Vector((49.84330749511719, 4.096793174743652, 15.015708923339844)),
    Vector((44.544437408447266, 4.80919075012207, 15.015708923339844)),
    Vector((45.23863220214844, 9.974420547485352, 15.015708923339844)),
    Vector((38.855899810791016, 12.579245567321777, 15.015708923339844)),
    Vector((34.07417297363281, 13.213733673095703, 15.015708923339844)),
    Vector((27.790645599365234, 12.31200885772705, 15.015708923339844)),
    Vector((27.096437454223633, 7.146780967712402, 15.015708923339844)),
    Vector((21.358366012573242, 7.914859294891357, 15.015708923339844)),
    Vector((21.655885696411133, 10.141250610351562, 15.015708923339844)),
    Vector((12.269540786743164, 11.399129867553711, 15.015708923339844)),
    Vector((15.478535652160645, 35.31056594848633, 15.015708923339844)),
    Vector((4.916293621063232, 36.72430419921875, 15.015708923339844)),
    Vector((0.0, 0.0, 15.015708923339844))
]
unitVectors = [
    Vector((0.13287095725536346, 0.9911333322525024, 0.0)),
    Vector((-0.9910830855369568, 0.1332455277442932, 0.0)),
    Vector((-0.13266676664352417, -0.9911606311798096, 0.0)),
    Vector((-0.991266667842865, 0.13187304139137268, 0.0)),
    Vector((-0.13245061039924622, -0.9911896586418152, 0.0)),
    Vector((-0.9910832047462463, 0.13324449956417084, 0.0)),
    Vector((0.13320006430149078, 0.9910891652107239, 0.0)),
    Vector((-0.9258665442466736, 0.3778507709503174, 0.0)),
    Vector((-0.9913111925125122, 0.13153724372386932, 0.0)),
    Vector((-0.989859402179718, -0.14205090701580048, 0.0)),
    Vector((-0.13320262730121613, -0.9910888671875, 0.0)),
    Vector((-0.9911597967147827, 0.1326732188463211, 0.0)),
    Vector((0.1324557065963745, 0.9911890029907227, 0.0)),
    Vector((-0.9911396503448486, 0.13282422721385956, 0.0)),
    Vector((0.1330108940601349, 0.9911145567893982, 0.0)),
    Vector((-0.9911608695983887, 0.13266520202159882, 0.0)),
    Vector((-0.13268661499023438, -0.9911580085754395, 0.0)),
    Vector((0.9911406636238098, -0.13281595706939697, 0.0))
]
holesInfo = None
firstVertIndex = 18
numPolygonVerts = 18

bpypolyskel.debugOutputs["skeleton"] = 1


faces = bpypolyskel.polygonize(verts, firstVertIndex, numPolygonVerts, holesInfo, 0.0, 0.5, None, unitVectors)


# the number of vertices in a face
for face in faces:
    assert len(face) >= 3


# duplications of vertex indices
for face in faces:
    assert len(face) == len(set(face))


# edge crossing
assert not bpypolyskel.checkEdgeCrossing(bpypolyskel.debugOutputs["skeleton"])