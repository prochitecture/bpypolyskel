import pytest
from mathutils import Vector
from bpypolyskel import bpypolyskel


verts = [
    Vector((2.662031888961792, -1.9926185607910156, 0.0)),
    Vector((4.011794090270996, -0.2560340166091919, 0.0)),
    Vector((14.238129615783691, -7.881409645080566, 0.0)),
    Vector((12.90711498260498, -9.66252326965332, 0.0)),
    Vector((15.119230270385742, -11.32118034362793, 0.0)),
    Vector((16.478364944458008, -9.506670951843262, 0.0)),
    Vector((24.127038955688477, -14.994706153869629, 0.0)),
    Vector((22.767906188964844, -17.042987823486328, 0.0)),
    Vector((25.617414474487305, -19.180315017700195, 0.0)),
    Vector((26.98592185974121, -17.454858779907227, 0.0)),
    Vector((34.3627815246582, -22.876096725463867, 0.0)),
    Vector((35.12202072143555, -21.82969093322754, 0.0)),
    Vector((-1.1810415983200073, 3.9295780658721924, 0.0)),
    Vector((-1.4341219663619995, 3.6178834438323975, 0.0)),
    Vector((1.171668529510498, 1.7031883001327515, 0.0)),
    Vector((0.0, 0.0, 0.0)),
    Vector((2.662031888961792, -1.9926185607910156, 3.2777960300445557)),
    Vector((4.011794090270996, -0.2560340166091919, 3.2777960300445557)),
    Vector((14.238129615783691, -7.881409645080566, 3.2777960300445557)),
    Vector((12.90711498260498, -9.66252326965332, 3.2777960300445557)),
    Vector((15.119230270385742, -11.32118034362793, 3.2777960300445557)),
    Vector((16.478364944458008, -9.506670951843262, 3.2777960300445557)),
    Vector((24.127038955688477, -14.994706153869629, 3.2777960300445557)),
    Vector((22.767906188964844, -17.042987823486328, 3.2777960300445557)),
    Vector((25.617414474487305, -19.180315017700195, 3.2777960300445557)),
    Vector((26.98592185974121, -17.454858779907227, 3.2777960300445557)),
    Vector((34.3627815246582, -22.876096725463867, 3.2777960300445557)),
    Vector((35.12202072143555, -21.82969093322754, 3.2777960300445557)),
    Vector((-1.1810415983200073, 3.9295780658721924, 3.2777960300445557)),
    Vector((-1.4341219663619995, 3.6178834438323975, 3.2777960300445557)),
    Vector((1.171668529510498, 1.7031883001327515, 3.2777960300445557)),
    Vector((0.0, 0.0, 3.2777960300445557))
]
unitVectors = [
    Vector((0.6136814951896667, 0.789553701877594, 0.0)),
    Vector((0.8016666769981384, -0.5977712869644165, 0.0)),
    Vector((-0.5986115336418152, -0.8010393977165222, 0.0)),
    Vector((0.800074577331543, -0.5999006032943726, 0.0)),
    Vector((0.5995066165924072, 0.8003697991371155, 0.0)),
    Vector((0.8124907612800598, -0.5829739570617676, 0.0)),
    Vector((-0.5528997182846069, -0.8332477807998657, 0.0)),
    Vector((0.7999735474586487, -0.6000351905822754, 0.0)),
    Vector((0.6214064359664917, 0.7834883332252502, 0.0)),
    Vector((0.8058034181594849, -0.5921831727027893, 0.0)),
    Vector((0.5872691869735718, 0.8093916773796082, 0.0)),
    Vector((-0.8155515789985657, 0.5786843299865723, 0.0)),
    Vector((-0.63033527135849, -0.7763230204582214, 0.0)),
    Vector((0.8058468699455261, -0.5921239852905273, 0.0)),
    Vector((-0.5667674541473389, -0.82387775182724, 0.0)),
    Vector((0.800563395023346, -0.5992480516433716, 0.0))
]
holesInfo = None
firstVertIndex = 16
numPolygonVerts = 16

bpypolyskel.debugOutputs["skeleton"] = 1


faces = bpypolyskel.polygonize(verts, firstVertIndex, numPolygonVerts, holesInfo, 0.0, 0.5, None, unitVectors)


# the number of vertices in a face
for face in faces:
    assert len(face) >= 3


# duplications of vertex indices
for face in faces:
    assert len(face) == len(set(face))


# edge crossing
assert not bpypolyskel.checkEdgeCrossing(bpypolyskel.debugOutputs["skeleton"])